<div class="issue-create-container">
  <!-- ローディング表示 -->
  <div class="loading-spinner" *ngIf="loading">
    <p>処理中...</p>
  </div>

  <!-- エラーメッセージ -->
  <div class="error-message" *ngIf="error">
    {{ error }}
  </div>

  <!-- 課題作成フォーム -->
  <div class="issue-form" *ngIf="!loading">
    <h2>新規課題の作成</h2>

    <div class="form-group">
      <label for="title">タイトル</label>
      <input
        type="text"
        id="title"
        class="form-control"
        [(ngModel)]="newIssue.title"
        placeholder="課題のタイトルを入力"
        required
      >
    </div>

    <div class="form-group">
      <label for="priority">優先度</label>
      <select
        id="priority"
        class="form-control"
        [(ngModel)]="newIssue.priority"
        required
      >
        <option value="high">高</option>
        <option value="medium">中</option>
        <option value="low">低</option>
      </select>
    </div>

    <div class="form-group">
      <label for="assignedTo">担当者</label>
      <select
        id="assignedTo"
        class="form-control"
        [(ngModel)]="newIssue.assignedTo"
        required
      >
        <option value="">担当者を選択</option>
        <option *ngFor="let member of projectMembers" [value]="member.uid">
          {{ member.displayName }}
        </option>
      </select>
    </div>

    <div class="form-group">
      <label for="dueDate">期限日</label>
      <input
        type="date"
        id="dueDate"
        class="form-control"
        [ngModel]="newIssue.dueDate | date:'yyyy-MM-dd'"
        (ngModelChange)="newIssue.dueDate = $event"
        [min]="minDate"
        required
      >
    </div>

    <div class="form-group">
      <label for="solution">解決方法</label>
      <textarea
        id="solution"
        class="form-control"
        [(ngModel)]="newIssue.solution"
        placeholder="課題の解決方法を入力"
        rows="4"
      ></textarea>
    </div>

    <!-- TODOリスト -->
    <div class="todos-section">
      <h3>TODOリスト</h3>
      <div class="todo-list">
        <div class="todo-item" *ngFor="let todo of newIssue.todos; let i = index">
          <input
            type="text"
            class="form-control"
            [(ngModel)]="todo.title"
            placeholder="TODOを入力"
          >
          <button class="remove-todo" (click)="removeTodo(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>
      <button class="add-todo" (click)="addTodo()">
        <i class="fas fa-plus"></i> TODOを追加
      </button>
    </div>

    <!-- フォームアクション -->
    <div class="form-actions">
      <button
        class="submit-button"
        (click)="createIssue()"
        [disabled]="!isFormValid()"
      >
        課題を作成
      </button>
      <button
        class="cancel-button"
        routerLink="/projects/{{projectId}}"
      >
        キャンセル
      </button>
    </div>
  </div>
</div> 