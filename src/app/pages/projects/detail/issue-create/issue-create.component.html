<div class="issue-create">
  <h2>新規課題作成</h2>

  <div *ngIf="errorMessage" class="error-alert">
    {{ errorMessage }}
  </div>

  <form (ngSubmit)="createIssue()" #issueForm="ngForm">
    <div class="form-group">
      <label for="title">タイトル</label>
      <input type="text" 
             id="title" 
             name="title" 
             [(ngModel)]="newIssue.title" 
             required 
             #title="ngModel"
             class="form-control"
             placeholder="課題のタイトルを入力">
      <div *ngIf="title.invalid && (title.dirty || title.touched)" class="error-message">
        タイトルは必須です
      </div>
    </div>

    <div class="form-group">
      <label for="priority">優先度</label>
      <select id="priority" 
              name="priority" 
              [(ngModel)]="newIssue.priority" 
              class="form-control">
        <option value="low">低</option>
        <option value="medium">中</option>
        <option value="high">高</option>
      </select>
    </div>

    <div class="form-group">
      <label for="assignedTo">担当者</label>
      <select id="assignedTo"
              name="assignedTo"
              [(ngModel)]="newIssue.assignedTo"
              required
              #assignedTo="ngModel"
              class="form-control">
        <option value="">担当者を選択</option>
        <option [value]="member.uid" *ngFor="let member of projectMembers">{{ member.displayName }}</option>
      </select>
      <div *ngIf="assignedTo.invalid && (assignedTo.dirty || assignedTo.touched)" class="error-message">
        担当者は必須です
      </div>
    </div>

    <div class="form-group">
      <label for="dueDate">締め切り日時</label>
      <input type="datetime-local" 
             id="dueDate" 
             name="dueDate" 
             [(ngModel)]="newIssue.dueDate" 
             [min]="minDate"
             required 
             #dueDate="ngModel"
             class="form-control">
      <div *ngIf="dueDate.invalid && (dueDate.dirty || dueDate.touched)" class="error-message">
        締め切り日時は必須です
      </div>
    </div>

    <div class="form-group">
      <label for="solution">解決方法</label>
      <textarea id="solution" 
                name="solution" 
                [(ngModel)]="newIssue.solution" 
                class="form-control"
                rows="3"
                placeholder="課題の解決方法を入力"></textarea>
    </div>

    <div class="form-group">
      <label>ToDoリスト</label>
      <app-todo-create [(todos)]="newIssue.todos"></app-todo-create>
    </div>

    <div class="form-actions">
      <button type="submit" 
              class="btn-primary" 
              [disabled]="!issueForm.form.valid || isSubmitting">
        {{ isSubmitting ? '作成中...' : '作成' }}
      </button>
    </div>

    <div *ngIf="!issueForm.form.valid" class="form-status">
      <p>フォームが無効です。以下の項目を確認してください：</p>
      <ul>
        <li *ngIf="title.invalid">タイトルを入力してください</li>
        <li *ngIf="assignedTo.invalid">担当者を選択してください</li>
        <li *ngIf="dueDate.invalid">締め切り日時を設定してください</li>
      </ul>
    </div>
  </form>
</div> 